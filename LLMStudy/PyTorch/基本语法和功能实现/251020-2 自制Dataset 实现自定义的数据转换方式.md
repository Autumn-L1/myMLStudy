---
jupyter:
  jupytext:
    cell_metadata_filter: -all
    formats: ipynb,md
    main_language: python
    text_representation:
      extension: .md
      format_name: markdown
      format_version: '1.3'
      jupytext_version: 1.17.3
---


```python
import torch
import torchvision
from torch.utils.data import Dataset
import numpy as np

import os
os.chdir('C:/Users/Errorwaf/Nutstore/1/我的坚果云/Obsidian/Knowledge Vault/Knowledge Vault/LLMStudy/PyTorch')
```

相当于实现torch内置dataset的transform参数例如
```python
# dataset = torchvision.datasets.MNIST(root="./data", transform = torchvision.transforms.ToTensor())
```

在上一章的基础上改变__init__和__getitem__

```python
class WineDataset(Dataset):
	def __init__(self, transform=None):
		#data loading
		xy = np.loadtxt('./_asset/data/wine.csv', delimiter = ",", dtype=np.float32, skiprows=1)
		# 上一章的数据转换代码，本节实现对这部分数据转换自定义
		# self.x=torch.from_numpy(xy[:,1:])
		# self.y=torch.from_numpy(xy[:,[0]])
		self.x=xy[:,1:]
		self.y=xy[:,[0]] #array of n_sample, 1
		self.transform = transform
		#self.n_samples = xy.shape[0]
		
	def __getitem__(self,index):
		sample = self.x[index], self.y[index]
		if self.transform:
			sample = self.transform(sample)
		return sample
	
	def __len__(self):
		return self.n_samples

class ToTensor:
	def __call__(self, sample):
		 inputs, targets = sample
		 return torch.from_numpy(inputs),torch.from_numpy(targets)

class MulTransform:
	def __init__(self,factor):
		self.factor = factor
	def __call__(self, sample):
		inputs,target = sample
		inputs *= self.factor
		return inputs,target
		
composed = torchvision.transforms.Compose([ToTensor(),MulTransform(2)])

dataset = WineDataset(transform = None)
first_data = dataset[0]
features, label = first_data
print(features, label)

dataset = WineDataset(transform = composed)
first_data = dataset[0]
features, label = first_data
print(features, label)
```
